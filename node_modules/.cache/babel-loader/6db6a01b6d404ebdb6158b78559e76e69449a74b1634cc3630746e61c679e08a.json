{"ast":null,"code":"const serverUrl=\"http://127.1.3.202:3000/rolls\";const rollDice=async formula=>{try{const rollData=parseFormula(formula);await sendRollDataToServer(rollData);return rollData;}catch(error){console.error(\"Error performing roll: \",error);return null;}};const parseFormula=formula=>{const advMatch=formula.match(/adv\\(([^)]+)\\)/);const disadvMatch=formula.match(/disadv\\(([^)]+)\\)/);if(advMatch){validateAdvDisadvFormula(advMatch[1]);return handleAdvDisadvRoll(advMatch[1],\"adv\",formula);}else if(disadvMatch){validateAdvDisadvFormula(disadvMatch[1]);return handleAdvDisadvRoll(disadvMatch[1],\"disadv\",formula);}else{return handleStandardRoll(formula);}};const handleAdvDisadvRoll=(mainFormula,type,fullFormula)=>{const additionalParts=fullFormula.replace(\"\".concat(type,\"(\").concat(mainFormula,\")\"),\"\").split(\"+\").map(part=>part.trim()).filter(Boolean);const mainRoll=type===\"adv\"?handleAdvantageRoll(mainFormula):handleDisadvantageRoll(mainFormula);const additionalRolls=additionalParts.map(part=>handleStandardRoll(part));const total=additionalRolls.reduce((sum,roll)=>sum+roll.total,mainRoll.total);const rolls=[mainRoll,...additionalRolls].flatMap(roll=>roll.rolls);return{formula:fullFormula,rolls,total,date:new Date().toISOString()};};const validateAdvDisadvFormula=formula=>{const parts=formula.split(\"+\").map(part=>part.trim());const diceParts=parts.filter(part=>part.includes(\"d\"));if(diceParts.length!==1){throw new Error(\"Формула некоректна, використовуйте лише 1 тип кубиків при кидку переваги чи перешкоди\");}};const handleStandardRoll=formula=>{const parts=formula.split(\"+\").map(part=>part.trim());const rolls=[];let total=0;parts.forEach(part=>{if(part.includes(\"d\")){const roll=rollSingleDice(part);rolls.push(...roll.rolls);total+=roll.total;}else{const modifier=parseInt(part,10);total+=modifier;rolls.push({value:modifier,isModifier:true});}});return{formula,rolls,total,date:new Date().toISOString()};};const handleAdvantageRoll=formula=>{const roll1=rollSingleDice(formula);const roll2=rollSingleDice(formula);const total=Math.max(roll1.total,roll2.total);return{formula:\"adv(\".concat(formula,\")\"),rolls:[...roll1.rolls,...roll2.rolls],total,date:new Date().toISOString()};};const handleDisadvantageRoll=formula=>{const roll1=rollSingleDice(formula);const roll2=rollSingleDice(formula);const total=Math.min(roll1.total,roll2.total);return{formula:\"disadv(\".concat(formula,\")\"),rolls:[...roll1.rolls,...roll2.rolls],total,date:new Date().toISOString()};};const rollSingleDice=formula=>{const[count,sides]=formula.split(\"d\").map(Number);const rolls=Array.from({length:count},()=>getRandomInt(1,sides));const total=rolls.reduce((sum,roll)=>sum+roll,0);return{rolls:rolls.map(value=>({value})),total};};const getRandomInt=(min,max)=>{min=Math.ceil(min);max=Math.floor(max);return Math.floor(Math.random()*(max-min+1))+min;};const sendRollDataToServer=async rollData=>{try{const response=await fetch(serverUrl,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(rollData)});if(!response.ok){throw new Error(\"Failed to send roll data to server\");}}catch(error){console.error(\"Error sending roll data to server: \",error);}};module.exports={rollDice};","map":{"version":3,"names":["serverUrl","rollDice","formula","rollData","parseFormula","sendRollDataToServer","error","console","advMatch","match","disadvMatch","validateAdvDisadvFormula","handleAdvDisadvRoll","handleStandardRoll","mainFormula","type","fullFormula","additionalParts","replace","concat","split","map","part","trim","filter","Boolean","mainRoll","handleAdvantageRoll","handleDisadvantageRoll","additionalRolls","total","reduce","sum","roll","rolls","flatMap","date","Date","toISOString","parts","diceParts","includes","length","Error","forEach","rollSingleDice","push","modifier","parseInt","value","isModifier","roll1","roll2","Math","max","min","count","sides","Number","Array","from","getRandomInt","ceil","floor","random","response","fetch","method","headers","body","JSON","stringify","ok","module","exports"],"sources":["/home/mbohach/Документи/personal/tabletop/src/DiceRoller/Roll-script.js"],"sourcesContent":["const serverUrl = \"http://127.1.3.202:3000/rolls\";\n\nconst rollDice = async (formula) => {\n  try {\n    const rollData = parseFormula(formula);\n    await sendRollDataToServer(rollData);\n    return rollData;\n  } catch (error) {\n    console.error(\"Error performing roll: \", error);\n    return null;\n  }\n};\n\nconst parseFormula = (formula) => {\n  const advMatch = formula.match(/adv\\(([^)]+)\\)/);\n  const disadvMatch = formula.match(/disadv\\(([^)]+)\\)/);\n\n  if (advMatch) {\n    validateAdvDisadvFormula(advMatch[1]);\n    return handleAdvDisadvRoll(advMatch[1], \"adv\", formula);\n  } else if (disadvMatch) {\n    validateAdvDisadvFormula(disadvMatch[1]);\n    return handleAdvDisadvRoll(disadvMatch[1], \"disadv\", formula);\n  } else {\n    return handleStandardRoll(formula);\n  }\n};\n\nconst handleAdvDisadvRoll = (mainFormula, type, fullFormula) => {\n  const additionalParts = fullFormula.replace(`${type}(${mainFormula})`, \"\").split(\"+\").map(part => part.trim()).filter(Boolean);\n  const mainRoll = type === \"adv\" ? handleAdvantageRoll(mainFormula) : handleDisadvantageRoll(mainFormula);\n  const additionalRolls = additionalParts.map(part => handleStandardRoll(part));\n\n  const total = additionalRolls.reduce((sum, roll) => sum + roll.total, mainRoll.total);\n  const rolls = [mainRoll, ...additionalRolls].flatMap(roll => roll.rolls);\n\n  return {\n    formula: fullFormula,\n    rolls,\n    total,\n    date: new Date().toISOString(),\n  };\n};\n\nconst validateAdvDisadvFormula = (formula) => {\n  const parts = formula.split(\"+\").map(part => part.trim());\n  const diceParts = parts.filter(part => part.includes(\"d\"));\n\n  if (diceParts.length !== 1) {\n    throw new Error(\"Формула некоректна, використовуйте лише 1 тип кубиків при кидку переваги чи перешкоди\");\n  }\n};\n\nconst handleStandardRoll = (formula) => {\n  const parts = formula.split(\"+\").map(part => part.trim());\n  const rolls = [];\n  let total = 0;\n\n  parts.forEach(part => {\n    if (part.includes(\"d\")) {\n      const roll = rollSingleDice(part);\n      rolls.push(...roll.rolls);\n      total += roll.total;\n    } else {\n      const modifier = parseInt(part, 10);\n      total += modifier;\n      rolls.push({ value: modifier, isModifier: true });\n    }\n  });\n\n  return {\n    formula,\n    rolls,\n    total,\n    date: new Date().toISOString(),\n  };\n};\n\nconst handleAdvantageRoll = (formula) => {\n  const roll1 = rollSingleDice(formula);\n  const roll2 = rollSingleDice(formula);\n  const total = Math.max(roll1.total, roll2.total);\n\n  return {\n    formula: `adv(${formula})`,\n    rolls: [...roll1.rolls, ...roll2.rolls],\n    total,\n    date: new Date().toISOString(),\n  };\n};\n\nconst handleDisadvantageRoll = (formula) => {\n  const roll1 = rollSingleDice(formula);\n  const roll2 = rollSingleDice(formula);\n  const total = Math.min(roll1.total, roll2.total);\n\n  return {\n    formula: `disadv(${formula})`,\n    rolls: [...roll1.rolls, ...roll2.rolls],\n    total,\n    date: new Date().toISOString(),\n  };\n};\n\nconst rollSingleDice = (formula) => {\n  const [count, sides] = formula.split(\"d\").map(Number);\n  const rolls = Array.from({ length: count }, () => getRandomInt(1, sides));\n  const total = rolls.reduce((sum, roll) => sum + roll, 0);\n\n  return {\n    rolls: rolls.map(value => ({ value })),\n    total,\n  };\n};\n\nconst getRandomInt = (min, max) => {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n};\n\nconst sendRollDataToServer = async (rollData) => {\n  try {\n    const response = await fetch(serverUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(rollData),\n    });\n\n    if (!response.ok) {\n      throw new Error(\"Failed to send roll data to server\");\n    }\n  } catch (error) {\n    console.error(\"Error sending roll data to server: \", error);\n  }\n};\n\nmodule.exports = { rollDice };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}