{"ast":null,"code":"import _objectSpread from\"/home/mbohach/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0438/personal/tabletop/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import{rollDice}from\"../DiceRoller/Roll-script\";import\"./CharacterGrid-styles.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const CharacterForm=_ref=>{let{onSubmit,onCancel}=_ref;const[formData,setFormData]=useState({});const[sections,setSections]=useState([]);const[system,setSystem]=useState(\"dnd\");const[errors,setErrors]=useState({});const[currentStep,setCurrentStep]=useState(1);useEffect(()=>{// Завантаження конфігураційного файлу для вибраної системи\nimport(\"../../configs/\".concat(system,\".json\")).then(config=>{setSections(config.sections);setErrors({});}).catch(err=>{console.error(\"Error loading config:\",err);setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{system:\"Невідома система.\"}));});},[system]);const handleChange=(e,sectionName)=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[sectionName]:_objectSpread(_objectSpread({},prev[sectionName]),{},{[name]:value})}));};const handleRoll=async(field,sectionName)=>{const rollResult=await rollDice(\"4d6\");const sortedRolls=rollResult.rolls.map(r=>r.value).sort((a,b)=>a-b);const total=sortedRolls.slice(1).reduce((sum,roll)=>sum+roll,0);setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[sectionName]:_objectSpread(_objectSpread({},prev[sectionName]),{},{[field]:total})}));};const validateForm=()=>{const newErrors={};sections.forEach(section=>{if(section.step===currentStep){section.fields.forEach(field=>{if(field.required&&(!formData[section.name]||!formData[section.name][field.name])){newErrors[\"\".concat(section.name,\".\").concat(field.name)]=\"\\u041F\\u043E\\u043B\\u0435 \".concat(field.label,\" \\u0454 \\u043E\\u0431\\u043E\\u0432'\\u044F\\u0437\\u043A\\u043E\\u0432\\u0438\\u043C.\");}});}});setErrors(newErrors);return Object.keys(newErrors).length===0;};const handleSubmit=e=>{e.preventDefault();if(validateForm()){if(currentStep===1){// Save the character after the first step\nonSubmit({system,sections:formData});setCurrentStep(currentStep+1);}else{// Update the character for subsequent steps\nonSubmit({system,sections:formData});}}};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"character-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"character-form__field\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"System\"}),/*#__PURE__*/_jsxs(\"select\",{value:system,onChange:e=>setSystem(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"dnd\",children:\"DnD\"}),/*#__PURE__*/_jsx(\"option\",{value:\"call_of_cthulhu\",children:\"Call of Cthulhu\"}),/*#__PURE__*/_jsx(\"option\",{value:\"vasen\",children:\"Vasen\"})]}),errors.system&&/*#__PURE__*/_jsx(\"span\",{className:\"error\",children:errors.system})]}),sections.filter(section=>section.step===currentStep).map(section=>/*#__PURE__*/_jsxs(\"div\",{className:\"character-form__section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:section.name}),section.fields.map(field=>{var _formData$section$nam;return/*#__PURE__*/_jsxs(\"div\",{className:\"character-form__field\",children:[/*#__PURE__*/_jsx(\"label\",{children:field.label}),/*#__PURE__*/_jsx(\"input\",{name:field.name,type:field.type,value:((_formData$section$nam=formData[section.name])===null||_formData$section$nam===void 0?void 0:_formData$section$nam[field.name])||\"\",onChange:e=>handleChange(e,section.name),required:field.required,className:\"character-form__input\"}),field.rollable&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>handleRoll(field.name,section.name),children:\"Roll\"}),errors[\"\".concat(section.name,\".\").concat(field.name)]&&/*#__PURE__*/_jsx(\"span\",{className:\"error\",children:errors[\"\".concat(section.name,\".\").concat(field.name)]})]},field.name);})]},section.name)),/*#__PURE__*/_jsxs(\"div\",{className:\"character-form__actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"character-form__button character-form__button--submit\",children:currentStep===1?\"Next\":\"Save\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:onCancel,className:\"character-form__button character-form__button--cancel\",children:\"Cancel\"})]})]});};","map":{"version":3,"names":["React","useState","useEffect","rollDice","jsx","_jsx","jsxs","_jsxs","CharacterForm","_ref","onSubmit","onCancel","formData","setFormData","sections","setSections","system","setSystem","errors","setErrors","currentStep","setCurrentStep","concat","then","config","catch","err","console","error","prev","_objectSpread","handleChange","e","sectionName","name","value","target","handleRoll","field","rollResult","sortedRolls","rolls","map","r","sort","a","b","total","slice","reduce","sum","roll","validateForm","newErrors","forEach","section","step","fields","required","label","Object","keys","length","handleSubmit","preventDefault","className","children","onChange","filter","_formData$section$nam","type","rollable","onClick"],"sources":["/home/mbohach/Документи/personal/tabletop/src/Character/CharacterForm-component.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { rollDice } from \"../DiceRoller/Roll-script\";\nimport \"./CharacterGrid-styles.css\";\n\nexport const CharacterForm = ({ onSubmit, onCancel }) => {\n  const [formData, setFormData] = useState({});\n  const [sections, setSections] = useState([]);\n  const [system, setSystem] = useState(\"dnd\");\n  const [errors, setErrors] = useState({});\n  const [currentStep, setCurrentStep] = useState(1);\n\n  useEffect(() => {\n    // Завантаження конфігураційного файлу для вибраної системи\n    import(`../../configs/${system}.json`)\n      .then((config) => {\n        setSections(config.sections);\n        setErrors({});\n      })\n      .catch((err) => {\n        console.error(\"Error loading config:\", err);\n        setErrors((prev) => ({\n          ...prev,\n          system: \"Невідома система.\",\n        }));\n      });\n  }, [system]);\n\n  const handleChange = (e, sectionName) => {\n    const { name, value } = e.target;\n    setFormData((prev) => ({\n      ...prev,\n      [sectionName]: {\n        ...prev[sectionName],\n        [name]: value,\n      },\n    }));\n  };\n\n  const handleRoll = async (field, sectionName) => {\n    const rollResult = await rollDice(\"4d6\");\n    const sortedRolls = rollResult.rolls.map(r => r.value).sort((a, b) => a - b);\n    const total = sortedRolls.slice(1).reduce((sum, roll) => sum + roll, 0);\n    setFormData((prev) => ({\n      ...prev,\n      [sectionName]: {\n        ...prev[sectionName],\n        [field]: total,\n      },\n    }));\n  };\n\n  const validateForm = () => {\n    const newErrors = {};\n    sections.forEach((section) => {\n      if (section.step === currentStep) {\n        section.fields.forEach((field) => {\n          if (field.required && (!formData[section.name] || !formData[section.name][field.name])) {\n            newErrors[`${section.name}.${field.name}`] = `Поле ${field.label} є обов'язковим.`;\n          }\n        });\n      }\n    });\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (validateForm()) {\n      if (currentStep === 1) {\n        // Save the character after the first step\n        onSubmit({ system, sections: formData });\n        setCurrentStep(currentStep + 1);\n      } else {\n        // Update the character for subsequent steps\n        onSubmit({ system, sections: formData });\n      }\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"character-form\">\n      <div className=\"character-form__field\">\n        <label>System</label>\n        <select value={system} onChange={(e) => setSystem(e.target.value)}>\n          <option value=\"dnd\">DnD</option>\n          <option value=\"call_of_cthulhu\">Call of Cthulhu</option>\n          <option value=\"vasen\">Vasen</option>\n        </select>\n        {errors.system && <span className=\"error\">{errors.system}</span>}\n      </div>\n      {sections.filter(section => section.step === currentStep).map((section) => (\n        <div key={section.name} className=\"character-form__section\">\n          <h3>{section.name}</h3>\n          {section.fields.map((field) => (\n            <div key={field.name} className=\"character-form__field\">\n              <label>{field.label}</label>\n              <input\n                name={field.name}\n                type={field.type}\n                value={formData[section.name]?.[field.name] || \"\"}\n                onChange={(e) => handleChange(e, section.name)}\n                required={field.required}\n                className=\"character-form__input\"\n              />\n              {field.rollable && (\n                <button type=\"button\" onClick={() => handleRoll(field.name, section.name)}>\n                  Roll\n                </button>\n              )}\n              {errors[`${section.name}.${field.name}`] && <span className=\"error\">{errors[`${section.name}.${field.name}`]}</span>}\n            </div>\n          ))}\n        </div>\n      ))}\n      <div className=\"character-form__actions\">\n        <button type=\"submit\" className=\"character-form__button character-form__button--submit\">\n          {currentStep === 1 ? \"Next\" : \"Save\"}\n        </button>\n        <button\n          type=\"button\"\n          onClick={onCancel}\n          className=\"character-form__button character-form__button--cancel\"\n        >\n          Cancel\n        </button>\n      </div>\n    </form>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}